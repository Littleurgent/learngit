UAP-NC 引领大型管理软件技术变革

用友软件集团及行业客户事业本部 技术总监 张伟

用友公司在1998年开始研发大集中系统，进入大型管理软件的领域，一直以来引领着大型管理软件的技术变革。
一、UAP-NC整体技术框架
UAP是UFIDA Application Platform的缩写。
UAP是：
稳定开放的底层技术平台，基于J2EE架构,跨数据库,跨操作系统,丰富的底层技术支持平台。
基于多组织架构的企业应用运行平台，提供业务流程,审批流程,会计平台,权限模型等。
基于模式化的开发平台，将管理信息系统的界面模式抽象成为：表单、报表、打印、查询功能的模式化 。
开放的系统集成平台，提供Portal和基于SOA的交换架构。
统一的系统管理平台，提供系统监控,统一配置。

UAP支持 Solaris Aix,Linux,Windows操作系统，通过J2EE技术实现跨平台；
UAP可以支持WebShpere,Weblogic,UFIDA Application Server，用友自己的中间件。 
二、UAP的历程
用友从1997年开始基于JAVA技术路线研发产品，1998年就发布NC 1.0 产品，叫做UAP1.0。UAP1.0实现了 B/S结构，开发并提供了基于TCP/IP协议的中间件服务器，支持大型关系型数据库。
到2001年发布的UAP有了比较大的提升：支持界面模版，支持审批流等。支持J2EE1.2规范J2EE服务器，用友中间件。
2004年的UAP3.0的最主要的特征是开发并应用了基于WFMC的工作流引擎，并建立了规模的性能优化团队。
2006年发布的UAP5.0与IBM深度合作NC支持WebSphere。
2008年将发布UAP6.0主要是发展集团的多级管理，优化MDA的模型等工作。
这里讲解一下用友对一些关键技术的理解。
界面技术方面Swing具有先天的高的可操作能力，具有非常好的可调试性，开发复杂应用的利器。对ERP的内部管理开发非常适合。
HTML+JS适合于简单的应用和信息发布，以及信息整合，在这些方面有非常大的优势。
对数据库技术方面的理解：
一定要有广泛社会基础的数据库，方便系统进行部署维护。
应用服务器：必须具有高的容错能力，健壮性，需要有高的并发能力，高的接入能力。
三、UAP-NC设计理念
	设计理念是确定UAP支持的应用形态，决定平台的价值取向。
UAP-NC的设计理念：（以下的层级关系是怎样的？）
集中管理、协同商务、流程重组。
1，	集中管理：首先是数据的大集中，然后是管理的大集中。
2，	协同商务：业务的上下游环节需要协同起来，提高业务的及时性和准确性，包括单位间的业务协同。
3，	流程重组：业务的各个环节需要根据业务的变化进行重组

NC对交付模式的理解是：产品交付首先是需要有良好的产品作为交付的基础，利用客户化工具对客户的应用角色等进行配置，仍然不能满足的才进行二次开发。
二次开发的推进的模式：首先以行业资深的顾问为龙头，加上设计分析团队，然后加上开发团队进行相关的分析和开发。用友为客户化和二次开发提供了丰富的资源。
客户化：做权限的配置，用户模板的配置和授权，流程的配置和授权等等。
二次开发：用友提供一套完整的企业信息管理的模型，在这个设计开发的理念下进行用户的贴身的软件开发。
三.一、管理信息系统
用友ERP-NC是面向集团型企业和高成长型企业推出的高端ERP产品，是中国第一款完全基于JAVA/J2EE技术开发的Web应用平台。可以满足集团企业管理应用的快速定制化，以及集中和分布式应用。
涵盖了从集中财务管理、供应链管理、生产制造、人力资源、商业智能等全面应用和10多个专业化的行业解决方案。目前，用友ERP-NC行业解决方案已被广泛应用于金融、烟草、电力、传媒、出版、医药、电子、大型连锁流通和其它制造业等诸多行业。 
我们认为管理信息系统的应用层次可以大致分为三个层次。
第一层：信息、资料的信息化和信息的共享，企业IT建设的第一步就是信息的数字化，不言而喻没有这个基础，管理信息化则是空谈，信息必须先数字化然后再谈管理。	
第二层：是应用的协同，有了基础的信息管理资料管理后，就上升到发挥企业内部业务协同，提升管理水平的层次。IT这个阶段需要解决的问题是：提升多环节的业务协同，提升业务运转的效率，减少不必要的路途消耗。减少不必要的数据的重复录入，使用系统监控提升业务的透明性。
第三层：决策、分析与预算控制，利用已经有的数据可以度量一个企业管理运行的健康状况，并在各个层次上实施必要的控制的职能。
三.二、企业信息模型
	UAP是根据用友对管理信息系统的抽象开发软件的，下面是用友的企业信息模型。
 
企业模型可以分为四层：
1，基本档案 
基本档案是我们的管理口径，这个反映了我们会以什么样的粒度管理企业信息，以及什么样的组织关系管理企业。
2，管理的实物
这个是各个业务系统管理的核心，比如财务管理的是企业按照核算整个钱、资金系统理的是资金、库存管理的是存货。
	我们的实物将按照管理口径设定归属以及进行分类。
3，业务活动
日常各个业务活动，这些业务活动将影响我们的管理的实物。信息系统记录我们的业务发生，这些业务发生将按照管理口径进行授权。
4，协同与决策
本层解决的是业务的协同与业务的商讨决策。包括相同业务间的系统和不同业务间的协同。
大集中系统中首先需要是信息安全问题，用友设计了多纬度的安全体系。
UAP-NC支持防火墙，VPN，SSL，CA认证等技术。并且结构模式决定数据库放在应用服务器后，不能被直接攻击。关键的数据可以采用数字签名的模式，比如：资金支付就需要数字签名。
内部的信息安全采用用户密码的管理。并且用户身份认证已经和多个合作伙伴测试多种身份认证。
UAP提供对功能以及功能按钮进行授权模式。
提供对数据项进行授权，对某个操作员的管理的范围进行授权。
企业管理软件的弹性包括：同一个业务单据在不同的操作者上展现不同。可以添加自定义项和自定义档案。构造在数据交换平台上流程平台，支持业务流程设置，就是业务的数据流。支持WMFC的工作流平台，支持审批流程的自定义。查询引擎支持数据的查询分析。动态会计平台可以灵活的集成业务系统和财务系统。动态会计平台可以设置;如何从一个业务数据转换成财务的多条数据，包括进入什么科目都可以动态配置。

三.三、UAP上强大的组件
	UAP上强大的组件有：工作流平台、预警平台、查询引擎、外部交换平台、动态会计平台、NC Portal、满足上面介绍的业务的变化和软件需要的弹性。
	流程平台支持业务的数据流程。
实施人员可以使用流程平台定义业务类型，对企业的业务进行分类。
 
上图是审批流支持条件的设置进行转移,而且支持多种模式的审批，抢占会签的模式。
UAP支持的WMFC，整个引擎以及系统接入都是用友自己开发的。
预警平台：使用预警平台提高业务处理的及时性灵活的插件配置，提供定时、业务动作中进行预警。按照预警平台的插件的注册，定义相关的阀值，可以设置多种预警的方式：消息，邮件，短信等模式。
查询引擎：是一个重量级的工具，可以根据应用的需求定义查询的需求。查询引擎既是一个开发工具，又是一个实施工具。
外部交换平台：外部交换平台主要是连接外部系统与NC系统的一个交换平台。交换平台最主要的功能是：1，可以让内外基础数据一致来2，可以让不同的程序语言开发的软件使用XML的交换模式进行数据交换。不同的XML格式进行转换。3，使用插件的模式进行数据整合可以添加特殊的业务处理，比使用ETL工具更加能达到应用整合的效果。
	NC Portal ：用友内部办公网就使用NC的Portal。可以做界面的布局，也可以做单点登陆的内容。
四、UAP-NC支撑大型管理软件
大型管理软件第一技术就是大数据量处理技术，然后是管理复杂技术。
下面对数据库、应用服务器、客户端技术予以剖析：
数据库技术方面：
首先设计团队对提高性能的技术一定要非常了解。
设计上要采用与业务无关的字段做主键，减少业务调整带来的数据调整。
TS设计可以做增量复制。
应用服务器：
需要设计高速的数据缓存。
需要使用无状态 BEAN，NC 不使用 Entity Bean。
应用服务器上的监控工具一定要好。
系统在执行什么任务，什么任务什么状态一定要清楚否则不能控制应用系统的状态。
客户端技术：
两种模式都要支持 UI SWING和HTML+JS模式。
对于UI SWING模式特别适合于功能复杂的界面，需要做一些本地数据缓存，特别是静态数据，提高性能。
SWING模式中有一个关键的技术，就是本地的代码版本管理一定要好。当更新补丁时较少代码下载两。
用友对高可靠性的理解：
	EJB无状态，客户端缓存，内存锁，集群部署，压力测试。
EJB无状态：减少应用服务器的内存压力，和重新进行任务处理的成本。
客户端的缓存：减少对服务器的访问压力，提高客户端访问速度。
内存锁：业务处理采用内存锁，减少数据库的冲突，利用业务锁对于数据访问冲突比较严重的进行隔离，可以减少数据库的数据锁。
集群部署：部署层面上应用服务器数据库服务器能够做集群。
	UAP的部署分为三层1，客户端2，WEB和应用服务层3，数据库层
客户端采用浏览器或Application模式运行。
在应用服务器层面主要是服务器集群。可以使用F5作流量分配，进行负责均衡，也可采用Webshpere的负载均衡功能。
数据库的集群主要考虑ORACLE RAC的能力，或者采用分布数据库的模式。
	压力测试：
下面是用友和HP，ORACLE一起测试的万人测试报告。采用6计算机作应用服务器。4个计算机作数据库集群。按照应用场景设计，分布万人并发对系统进行压力测试。
下面的图是我们的压力测试的结果。满足万人并发应用。
 
五、UAP-NC数据集成和二次开发
由于应用软件的高速发展。任何一个软件都只能覆盖全部的应用。而且所有的软件不能成为信息孤岛，也不能成为应用孤岛。所以数据集成与应用集成在现代的IT建设中越来越重要。管理信息系统纵横交错，关联复杂，系统之间就像蜘蛛网连接。
	用友的观点是：使用UAP-NC支撑企业整体的信息建设。
UAP基础应用平台提供：工作流平台、审批流平台、预警平台、动态会计平台、二次开发平台、系统配置平台、动态建模工具、报表工具、二次开发工具、分析工具，满足集成的要求。
五.一、系统集成
系统集成在应用方面可以分为：报表数据、业务数据、应用协同、门户与单一登录、数据集市与数据仓库。
技术层面上有：Portal、数据字典与元数据、数据仓库、ETL、展现工具等相关技术。
报表数据集成相关简单：传递一个数据报表就可以了，没有什么交互动作。比如：银监会的1104非现场监管报表等。对系统集成度要求不高，适合于事后统计分析，简单易用，容易实现。
业务数据集成：需要做许多工作比较重要的是：建立统一的基础数据管理，建立数据交换的格式，交换的数据核对，关联数据的查询的工作。这个是目前大多数数据的集成的方式。
应用协同、流程集成：业务数据集成基础上，将业务流程集成起来，实现信息提醒，业务自动化等。提高集成带来的应用效率。在业务数据集技术基础上，还需要集成应用平台有消息平台、短信平台等功能。
门户与单一登录：门户与单一登录相对上面的集成偏技术一些，对应用数据的约束少一些。门户主要解决的是展现信息的集成，单一登录涉及到身份认证的统一，用友在许多项目上进行门户、单一登录的集成。
数据仓库与数据集市：在业务数据非常庞大以后，为了应用分析，可以使用数据仓库技术。分离联机事务处理与分析、历史数据查询的一个非常重要的一个方法。前端使用ETL工具将不同的系统按照规则抽取到数据仓库中，建立统一的统计纬度，建立数据立方体和根据应用需要的数据集市，建立分析指标，以达到相关的应用要求。
五.二、二次开发
在二次开发上：UAP-NC提供了一套完整的基于Eclips的二次开发工具。降低了开发的难度和NC系统集成的难度。
二次开发组织方面：我们提供年度的开发培训，有七天的培训课程，
 	年度开发培训
 	第一天_建立环境
 	第二天_表单开发
 	第三天_工作流开发
 	第四天_报表开发
 	第五天_基础框架与持久化
 	第六天_外部交换平台
 	第七天_表单深入培训
 	合作伙伴开发网站
 	发布培训教育
 	发布二次开发成果
 	技术论坛
二次开发建立了合作伙伴开发网站：发布培训教育的内容，发布二次开发成果，组织技术论坛，介绍开发案例等。
二次开发提供嵌入式开发的开放接口。比如：基本档案事件通知机制 、单据号开发、持久化、参数开发、数据传输、数据卸载、内存级缓存、预警开发。
五.三、UAP价值
UAP-NC对客户和伙伴的价值是：
 	提供一个高效稳定可靠的运行平台
 	提供一套完善开发理念
 	提供一个开发环境
 	丰富的开发基础资源
 	管理信息系统的建设参考篮本
UFIDA用友软件愿意做客户信赖的长期合作的伙伴。

